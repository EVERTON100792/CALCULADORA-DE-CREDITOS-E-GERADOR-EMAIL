<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Logística v16.2 [Com Preview]</title>
    <style>
        /* --- ESTILOS GERAIS (CSS) - TEMA ESCURO --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --bg-color: #1a1a2e;
            --container-color: #1f1f38;
            --primary-color: #4a90e2;
            --primary-hover-color: #357ABD;
            --text-color: #e0e0e0;
            --label-color: #a0a0b0;
            --border-color: #40405c;
            --input-bg-color: #2c2c44;
            --preview-bg-color: #25253a; /* Nova cor para a caixa de preview */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: var(--container-color);
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 750px;
            border-top: 3px solid var(--primary-color);
        }

        h1 {
            color: #ffffff;
            text-align: center;
            margin-top: 0;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group { display: flex; flex-direction: column; }
        .full-width { grid-column: 1 / -1; }

        label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--label-color);
        }
        .radio-group label { margin-bottom: 0; margin-left: 5px; font-weight: 400;}
        .radio-group div { display: flex; align-items: center; }


        input, select {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
            width: 100%; /* Mantendo a correção anterior de layout */
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(74, 144, 226, 0.3);
        }

        /* Estilo específico para a barra de busca */
        .search-input {
            margin-bottom: 8px;
        }

        .btn {
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            text-transform: uppercase;
            width: 100%;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            margin-top: 15px; /* Reduzido para dar espaço ao preview */
        }
        .btn-primary:hover { background-color: var(--primary-hover-color); }
        .btn:active { transform: translateY(1px); }
        
        .mode-switcher { display: flex; gap: 10px; margin-bottom: 25px; }
        .btn-mode {
            flex-grow: 1; padding: 12px;
            background-color: var(--input-bg-color); color: var(--label-color);
            border: 1px solid var(--border-color); font-weight: 500;
        }
        .btn-mode.active {
            background-color: var(--primary-color); color: white; border-color: var(--primary-color);
        }

        /* --- NOVO ESTILO PARA A CAIXA DE PREVIEW --- */
        .preview-box {
            background-color: var(--preview-bg-color);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 1.05em;
        }
         .preview-box strong {
            color: var(--primary-color);
            font-weight: 700;
        }
        .preview-box div { 
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gerador de E-mail para Logística</h1>

        <div class="mode-switcher">
            <button id="modeCreditoBtn" class="btn btn-mode active">Crédito por KM</button>
            <button id="modePortariaBtn" class="btn btn-mode">Liberação Portaria</button>
            <button id="modeTransbordoBtn" class="btn btn-mode">Transbordo</button>
        </div>
        
        <hr style="border-color: var(--border-color); margin: 25px 0;">

        <div id="generalEmailFields">
            <div class="form-group full-width">
                <label for="emailDestinatario">Destinatário(s) (separar por vírgula):</label>
                <input type="text" id="emailDestinatario" value="ana@empresa.com" placeholder="email@exemplo.com, outro@exemplo.com">
            </div>
            <div class="form-group full-width">
                <label for="emailCopia">CC (em cópia - separar por vírgula):</label>
                <input type="text" id="emailCopia" placeholder="copia@exemplo.com">
            </div>
        </div>

        <div id="formCredito">
             <div class="form-group full-width">
                <label for="motoristaCredito">Selecione o Motorista:</label>
                <input type="text" id="searchMotoristaCredito" class="search-input" placeholder="Digite para buscar...">
                <select id="motoristaCredito"></select>
            </div>
            <div class="form-grid">
                <div class="form-group"><label for="kmInformado">KM Informado (Motorista):</label><input type="number" id="kmInformado" placeholder="Ex: 500"></div>
                <div class="form-group"><label for="kmPago">KM Pago (Empresa):</label><input type="number" id="kmPago" placeholder="Ex: 455"></div>
                <div class="form-group full-width"><label for="motivo">Motivo da Diferença:</label><select id="motivo"><option value="de estrada de chão">Estrada de Chão</option><option value="de distrito">Distrito</option></select></div>
                <div class="form-group"><label for="valorKm">Valor por KM (R$):</label><input type="number" id="valorKm" value="2.11" step="0.01"></div>
                <div class="form-group"><label for="autorizacaoSaida">Nº Saída (Opcional):</label><input type="number" id="autorizacaoSaida" placeholder="Ex: 12345"></div>
                 <div class="form-group full-width"><label for="nomeRemetenteCredito">Seu Nome (para assinatura):</label><input type="text" id="nomeRemetenteCredito" placeholder="Seu nome completo"></div>
            </div>
            
            <div class="preview-box">
                Valor do Crédito: <strong id="previewCredito">R$ 0,00</strong>
            </div>

            <button id="gerarCreditoBtn" class="btn btn-primary">Preparar E-mail para Envio</button>
        </div>

        <div id="formPortaria" style="display: none;">
            <div class="form-group full-width">
                <label for="emailDestinatarioPortaria">Destinatário da Portaria (separar por vírgula):</label>
                <input type="text" id="emailDestinatarioPortaria" value="portaria@empresa.com" placeholder="email.portaria@exemplo.com">
            </div>
            <div class="form-group full-width">
                <label for="emailCopiaPortaria">CC Portaria (em cópia - separar por vírgula):</label>
                <input type="text" id="emailCopiaPortaria" placeholder="copia.portaria@exemplo.com">
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">

             <div class="form-group full-width">
                <label for="motoristaPortaria">Selecione o Motorista:</label>
                <input type="text" id="searchMotoristaPortaria" class="search-input" placeholder="Digite para buscar...">
                <select id="motoristaPortaria"></select>
            </div>
             <div class="form-grid">
                <div class="form-group full-width"><label for="tipoVeiculo">Tipo de Veículo:</label><select id="tipoVeiculo"><option value="VAN">VAN</option><option value="FIORINO">FIORINO</option><option value="3/4">3/4</option><option value="TOCO">TOCO</option></select></div>
                 <div class="form-group full-width"><label for="nomeRemetentePortaria">Seu Nome (para assinatura):</label><input type="text" id="nomeRemetentePortaria" placeholder="Seu nome completo"></div>
            </div>
            <button id="gerarPortariaBtn" class="btn btn-primary">Preparar E-mail para Envio</button>
        </div>

        <div id="formTransbordo" style="display: none;">
            <div class="form-group full-width radio-group">
                <label>Tipo de Transbordo:</label>
                <div>
                    <input type="radio" id="tipoProporcional" name="tipoTransbordo" value="proporcional" checked>
                    <label for="tipoProporcional">Pagamento Proporcional (entregas parciais)</label>
                </div>
                <div>
                    <input type="radio" id="tipoIntegral" name="tipoTransbordo" value="integral">
                    <label for="tipoIntegral">Pagamento Integral (sem entregas feitas)</label>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="motoristaOriginal">Motorista Original (com problema):</label>
                    <input type="text" id="searchMotoristaOriginal" class="search-input" placeholder="Digite para buscar...">
                    <select id="motoristaOriginal"></select>
                </div>
                <div class="form-group">
                    <label for="motoristaSubstituto">Motorista Substituto:</label>
                    <input type="text" id="searchMotoristaSubstituto" class="search-input" placeholder="Digite para buscar...">
                    <select id="motoristaSubstituto"></select>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="valorTotalFrete">Valor Total do Frete (R$):</label>
                    <input type="number" id="valorTotalFrete" placeholder="Ex: 350.00">
                </div>
                <div class="form-group">
                    <label for="numeroSaidaTransbordo">Número da Saída:</label>
                    <input type="number" id="numeroSaidaTransbordo" placeholder="Ex: 67890">
                </div>
            </div>
            
            <div id="camposProporcional" class="form-grid">
                 <div class="form-group">
                    <label for="totalEntregas">Nº Total de Entregas:</label>
                    <input type="number" id="totalEntregas" placeholder="Ex: 7">
                </div>
                 <div class="form-group">
                    <label for="entregasFeitas">Nº Entregas feitas pelo Original:</label>
                    <input type="number" id="entregasFeitas" placeholder="Ex: 3">
                </div>
            </div>

            <div class="preview-box">
                <div>Valor p/ Motorista Original: <strong id="previewValorOriginal">R$ 0,00</strong></div>
                <div>Valor p/ Motorista Substituto: <strong id="previewValorSubstituto">R$ 0,00</strong></div>
            </div>

            <div class="form-group full-width">
                <label for="nomeRemetenteTransbordo">Seu Nome (para assinatura):</label>
                <input type="text" id="nomeRemetenteTransbordo" placeholder="Seu nome completo">
            </div>
            <button id="gerarTransbordoBtn" class="btn btn-primary">Preparar E-mail para Envio</button>
        </div>

    </div>

    <script>
        const motoristas = [
            { nome: "ABRAAO MESSIAS POLICANTI", codigo: "577", placa: "AGX3I88" }, { nome: "AGENOR DIAS", codigo: "741", placa: "MBF8J91" }, { nome: "ALAIN BASSI DO NASCIMENTO", codigo: "781", placa: "EPQ7554" }, { nome: "ALEX RIBEIRO", codigo: "123", placa: "DHW2J53" }, { nome: "ALEX SANDRO OLIVEIRA DE ALMIEIDA", codigo: "925", placa: "ATB2F08" }, { nome: "ALEXSANDRO REIS", codigo: "423", placa: "ETF0D64" }, { nome: "ALEXSANDRO SILVA DA COSTA", codigo: "481", placa: "LOM8J38" }, { nome: "ALICIO BATISTA PAIVA", codigo: "754", placa: "ASG9F40" }, { nome: "ALISSON LUIZ LOUCAO", codigo: "403", placa: "AQJ9H16" }, { nome: "ANDRO ALIRIO FERREIRA", codigo: "441", placa: "AOC3G53" }, { nome: "ANISIO DA SILVA", codigo: "682", placa: "EJE1A71" }, { nome: "ANTONIO MARCOS NUNES DE OLIVEIRA", codigo: "901", placa: "ARY5F11" }, { nome: "APARECIDO BARBOSA DE LIMA", codigo: "408", placa: "EZU3J87" }, { nome: "BRUNO GONCALVES RIBEIRO GUIMARAES", codigo: "101", placa: "DBH7D23" }, { nome: "CARLOS ALBERTO DE OLIVEIRA", codigo: "495", placa: "BCC4F88" }, { nome: "CARLOS EDUARDO GOMES", codigo: "478", placa: "AYG9C90" }, { nome: "CARLOS ZOBERTO ECHAMENDI", codigo: "554", placa: "LPP0J82" }, { nome: "CICERO RODRIGUES", codigo: "831", placa: "ASU6C30" }, { nome: "CLAUDIMAR RODRIGUES", codigo: "916", placa: "BAH5J78" }, { nome: "CLAUDINEI APARECIDO BRISDA", codigo: "820", placa: "OIF4B89" }, { nome: "CLAUDINEI APARECIDO MENDES", codigo: "185", placa: "BBK2D30" }, { nome: "CLAUDINEI DE SOUZA", codigo: "829", placa: "DQR8B21" }, { nome: "CLOVIS AUGUSTO GUIMARAES", codigo: "321", placa: "AFJ7812" }, { nome: "CRISTIANO DE SOUZA LIMA", codigo: "631", placa: "MFX0C52" }, { nome: "CRISTIANO DOLEMBA", codigo: "398", placa: "FKT2F73" }, { nome: "DANILO JUNIOR ALACOQUE", codigo: "814", placa: "DJC2D45" }, { nome: "DANNILO JUNIOR DA COSTA", codigo: "469", placa: "GRA3D21" }, { nome: "DAVID BRUNO DOS SANTOS DIAS", codigo: "661", placa: "GUU9904" }, { nome: "DENIELTON BUENO DA SILVA", codigo: "143", placa: "BTO6D76" }, { nome: "EDERSON DA SILVA", codigo: "91", placa: "AWA3D28" }, { nome: "EDIVALDO FABRICIO DE LIMA", codigo: "860", placa: "AJI4656" }, { nome: "EDSON MESSIAS", codigo: "800", placa: "CPR0J63" }, { nome: "EDUARDO VINICIUS BALISIO", codigo: "463", placa: "LSM4H90" }, { nome: "ELI BERNARDINO ALMEIDA", codigo: "182", placa: "SEQ0J71" }, { nome: "ERLI BERNARDINO", codigo: "182", placa: "SEO0J71" }, { nome: "EVERTON LUIS MOURA", codigo: "297", placa: "AOZ3J39" }, { nome: "EVERTON ROBSON DA SILVA", codigo: "464", placa: "ARV7J35" }, { nome: "EVERTON RODRIGO TUPAN", codigo: "433", placa: "FUI0J65" }, { nome: "FABIO DA SILVA OLIVIRA", codigo: "381", placa: "PVQ3A82" }, { nome: "FABIO DOS SANTOS", codigo: "121", placa: "BBK2D41" }, { nome: "FELIPE BIANCHI", codigo: "817", placa: "BDC7C29" }, { nome: "FERNANDO MESSIAS POLICANTI", codigo: "900", placa: "ARY5F11" }, { nome: "FERNANDO MESSIAS POLICANTI NETO", codigo: "131", placa: "EJW8E42" }, { nome: "FLAVIO ANTONIO DE CARVALHO", codigo: "855", placa: "ARB5176" }, { nome: "FLAVIO CESAR SHIGEAKI FURU", codigo: "813", placa: "BCR1I38" }, { nome: "GENIEL DE SOUSA POLICANTI AS", codigo: "816", placa: "AOQ0A48" }, { nome: "GENIVAL LINO DE ALMEIDA", codigo: "909", placa: "HMC5H95" }, { nome: "GERALDO TEODORO", codigo: "418", placa: "ATD3G45" }, { nome: "GILMAR MENDES DE OLIVEIRA", codigo: "244", placa: "AYG1B15" }, { nome: "HELIO DOS SANTOS ABREU", codigo: "431", placa: "EKH0I50" }, { nome: "HENRIQUE DA SILVA STAVANATO", codigo: "440", placa: "MLV2C15" }, { nome: "HENRIQUE DA SILVEIRA TAVARES", codigo: "140", placa: "MLV5G12" }, { nome: "IGOR DA SILVA DE JESUS", codigo: "421", placa: "AJR3E53" }, { nome: "IRINEU CARDOSO DE MOURA", codigo: "722", placa: "AHK0011" }, { nome: "IVAN BORTOLOSSI DE SOUZA", codigo: "395", placa: "TAY2F85" }, { nome: "JAIR DE ASSIS DE JESUS", codigo: "325", placa: "AQQ5I31" }, { nome: "JECIEL TEODORO DA SILVA", codigo: "840", placa: "ABY2B31" }, { nome: "JEFERSON DOS SANTOS COSTA", codigo: "500", placa: "ARY5F11" }, { nome: "JESAEL CARNEIRO DE MELO", codigo: "150", placa: "ATA0C31" }, { nome: "JOAO BATISTA URONANI", codigo: "627", placa: "SEU8J28" }, { nome: "JOAO MANOEL DE SOUZA SEVERO", codigo: "715", placa: "BEB7H99" }, { nome: "JOAO PAULO MACHADO BARBOSA", codigo: "818", placa: "FNZ2J53" }, { nome: "JOAO VITOR TREDER CHACON", codigo: "821", placa: "MDV8J42" }, { nome: "JORGE ARMANDO RIVERA LOPES", codigo: "900", placa: "FWG7H74" }, { nome: "JOSE ANGELO DOS SANTOS", codigo: "944", placa: "AQB0H89" }, { nome: "JOSE BENEDITO DE OLIVEIRA", codigo: "908", placa: "IYL0H15" }, { nome: "JOSE CARLOS DE OLIVEIRA", codigo: "130", placa: "AQQ8B23" }, { nome: "JOSEMAR DO NASCIMENTO", codigo: "112", placa: "EWJ0B95" }, { nome: "JOSIAS BATISTA ALMEIDA", codigo: "406", placa: "BDN3D74" }, { nome: "JULIANO NUNES KISTENMACHER", codigo: "803", placa: "APF0E63" }, { nome: "LEONARDO OLIVEIRA RESENDE", codigo: "428", placa: "BDN0A67" }, { nome: "MAICON HENRIQUE DIAS", codigo: "806", placa: "AWV9F72" }, { nome: "MAIKON MICHEL RODRIGUES", codigo: "893", placa: "AQC4D55" }, { nome: "MARCELO APARECIDO GERALDO", codigo: "807", placa: "AKW2J76" }, { nome: "MARCELO PETENASSI ZARAMELA", codigo: "400", placa: "ACC1A28" }, { nome: "MARCELO PEREIRA ALVES", codigo: "181", placa: "APN0081" }, { nome: "MARCIO FABIO GARCIA", codigo: "437", placa: "B544D68" }, { nome: "MARCO FABIO GARCIA", codigo: "477", placa: "BSQ5D65" }, { nome: "MARCOS ALVES DA SILVA", codigo: "394", placa: "BMB8J88" }, { nome: "MARCOS APARECIDO IRMER", codigo: "404", placa: "AOF0I81" }, { nome: "MARCOS ROBERTO DE OLIVEIRA", codigo: "737", placa: "SEL8D06" }, { nome: "MARCOS ROBERTO DIAS", codigo: "802", placa: "HSD4543" }, { nome: "MATHEUS GABRIEL DE SOUZA MEIRA", codigo: "376", placa: "ARU8B29" }, { nome: "MATHEUS HENRIQUE DE SOUZA", codigo: "526", placa: "ATG1J95" }, { nome: "MAURO DA SILVA", codigo: "241", placa: "AWZ3A35" }, { nome: "NEYMAR KONOPKA", codigo: "970", placa: "AXY7G76" }, { nome: "ODAIR JOSE DE CARVALHO", codigo: "885", placa: "DRR2C83" }, { nome: "ODILO CARLOS MOREIRA DOS SANTOS", codigo: "521", placa: "AYD7C78" }, { nome: "OLIVIO PIRES GONCALVES", codigo: "854", placa: "JJZ4G84" }, { nome: "OSWALDO SADAHALU KOBATA", codigo: "736", placa: "QDN7G63" }, { nome: "PAULO ROGERIO FRANQUELO", codigo: "429", placa: "GOV1D72" }, { nome: "PAULO VICENTE DOS SANTOS", codigo: "784", placa: "ALT5H85" }, { nome: "PETERSON VINICIUS DOS SANTOS CARDOSO", codigo: "444", placa: "BBV9E74" }, { nome: "RAFAEL GOMES FERREIRA", codigo: "133", placa: "AYG9C89" }, { nome: "RAFAEL ROMUALDO DA SILVA", codigo: "424", placa: "OCJ7J49" }, { nome: "REGINALDO APARECIDO DOS SANTOS", codigo: "297", placa: "A0Z3J39" }, { nome: "REGINALDO GOMES DE ARRUDA", codigo: "824", placa: "OQU7J49" }, { nome: "REINALDO APARECIDO PONTES", codigo: "372", placa: "MQS9C71" }, { nome: "RENATO RODRIGUES OLIVEIRA", codigo: "132", placa: "AQT5B32" }, { nome: "RICARDO INVINCICNHI", codigo: "839", placa: "DQR8B21" }, { nome: "RICARDO INNVINNCHL", codigo: "829", placa: "DQR0B21" }, { nome: "ROBERTO GOMES DE ABREU", codigo: "432", placa: "BCZ3F43" }, { nome: "ROBERTO PEREIRA FELIX", codigo: "822", placa: "AKC6G32" }, { nome: "ROBERTO RIBEIRO", codigo: "820", placa: "AXX9H77" }, { nome: "ROBERTO ROMOALDO DA SILVA", codigo: "432", placa: "ACC3A57" }, { nome: "RODRIGO DE SOUSA", codigo: "513", placa: "AMH4D32" }, { nome: "RONALDO VALENTIN DAMACENO", codigo: "384", placa: "ANC4J53" }, { nome: "SANDERSON HERCULANO DA COSTA", codigo: "245", placa: "AYN7G19" }, { nome: "SILVIO CESAR SHIGEAKI FURUMITI", codigo: "814", placa: "DJC2D45" }, { nome: "TIAGO GALETI", codigo: "872", placa: "AXN0F66" }, { nome: "VAGNER APARECIDO SAQUELI", codigo: "425", placa: "AXX9H76" }, { nome: "VAGNER JOSE LIMA DE SOUZA", codigo: "915", placa: "AUH6F51" }, { nome: "VALDEILDO DE SOUZA", codigo: "402", placa: "MJB2C47" }, { nome: "VALDINEI DE SOUZA", codigo: "435", placa: "AJI8236" }, { nome: "VALDINEI JOSE CALLADO", codigo: "460", placa: "KCR2E43" }, { nome: "VALDIR ZAMONETA", codigo: "828", placa: "DHF588" }, { nome: "VINICIUS PEREIRA SOARES", codigo: "503", placa: "BAN8678" }, { nome: "VOLMIR DA SILVA", codigo: "419", placa: "AME2C78" }, { nome: "WESLEY DAYRTON DO NASCIMENTO", codigo: "485", placa: "MKN-1D60" }, { nome: "WILSON ALVES SILVEIRA", codigo: "874", placa: "DAH4G00" }
        ];
        
        // --- INÍCIO: Seleção de Elementos ---
        const emailDestinatarioInput = document.getElementById('emailDestinatario');
        const emailCopiaInput = document.getElementById('emailCopia');
        const emailDestinatarioPortariaInput = document.getElementById('emailDestinatarioPortaria');
        const emailCopiaPortariaInput = document.getElementById('emailCopiaPortaria');
        const motoristaCreditoSelect = document.getElementById('motoristaCredito');
        const kmInformadoInput = document.getElementById('kmInformado');
        const kmPagoInput = document.getElementById('kmPago');
        const motivoSelect = document.getElementById('motivo');
        const valorKmInput = document.getElementById('valorKm');
        const autorizacaoSaidaInput = document.getElementById('autorizacaoSaida');
        const nomeRemetenteCreditoInput = document.getElementById('nomeRemetenteCredito');
        const gerarCreditoBtn = document.getElementById('gerarCreditoBtn');
        const motoristaPortariaSelect = document.getElementById('motoristaPortaria');
        const tipoVeiculoSelect = document.getElementById('tipoVeiculo');
        const nomeRemetentePortariaInput = document.getElementById('nomeRemetentePortaria');
        const gerarPortariaBtn = document.getElementById('gerarPortariaBtn');
        const motoristaOriginalSelect = document.getElementById('motoristaOriginal');
        const motoristaSubstitutoSelect = document.getElementById('motoristaSubstituto');
        const valorTotalFreteInput = document.getElementById('valorTotalFrete');
        const numeroSaidaTransbordoInput = document.getElementById('numeroSaidaTransbordo');
        const camposProporcionalDiv = document.getElementById('camposProporcional');
        const totalEntregasInput = document.getElementById('totalEntregas');
        const entregasFeitasInput = document.getElementById('entregasFeitas');
        const nomeRemetenteTransbordoInput = document.getElementById('nomeRemetenteTransbordo');
        const gerarTransbordoBtn = document.getElementById('gerarTransbordoBtn');
        const radiosTransbordo = document.querySelectorAll('input[name="tipoTransbordo"]');

        // NOVOS ELEMENTOS PARA O PREVIEW
        const previewCreditoSpan = document.getElementById('previewCredito');
        const previewValorOriginalSpan = document.getElementById('previewValorOriginal');
        const previewValorSubstitutoSpan = document.getElementById('previewValorSubstituto');
        // --- FIM: Seleção de Elementos ---

        let motoristasProcessados = [];
        
        const fieldsToSave = [
            'emailDestinatario', 'emailCopia', 'emailDestinatarioPortaria', 'emailCopiaPortaria',
            'motoristaCredito', 'kmInformado', 'kmPago', 'motivo', 'valorKm',
            'autorizacaoSaida', 'nomeRemetenteCredito', 'motoristaPortaria', 'tipoVeiculo', 'nomeRemetentePortaria',
            'motoristaOriginal', 'motoristaSubstituto', 'valorTotalFrete', 'numeroSaidaTransbordo', 'totalEntregas',
            'entregasFeitas', 'nomeRemetenteTransbordo'
        ];
        const radioNameToSave = 'tipoTransbordo';

        // --- INÍCIO: NOVAS FUNÇÕES DE PREVIEW ---
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function atualizarPreviewCredito() {
            const kmInfo = parseFloat(kmInformadoInput.value) || 0;
            const kmPago = parseFloat(kmPagoInput.value) || 0;
            const valorKm = parseFloat(valorKmInput.value) || 0;

            if (kmInfo > kmPago) {
                const credito = (kmInfo - kmPago) * valorKm;
                previewCreditoSpan.textContent = formatarMoeda(credito);
            } else {
                previewCreditoSpan.textContent = formatarMoeda(0);
            }
        }

        function atualizarPreviewTransbordo() {
            const valorTotal = parseFloat(valorTotalFreteInput.value) || 0;
            const tipo = document.querySelector('input[name="tipoTransbordo"]:checked').value;

            if (tipo === 'proporcional') {
                const totalEntregas = parseInt(totalEntregasInput.value) || 0;
                const entregasFeitas = parseInt(entregasFeitasInput.value) || 0;
                
                if (totalEntregas > 0 && entregasFeitas >= 0 && entregasFeitas <= totalEntregas) {
                    const valorOriginal = (valorTotal / totalEntregas) * entregasFeitas;
                    const valorSubstituto = valorTotal - valorOriginal;
                    previewValorOriginalSpan.textContent = formatarMoeda(valorOriginal);
                    previewValorSubstitutoSpan.textContent = formatarMoeda(valorSubstituto);
                } else {
                    previewValorOriginalSpan.textContent = formatarMoeda(0);
                    previewValorSubstitutoSpan.textContent = formatarMoeda(0);
                }
            } else { // Integral
                previewValorOriginalSpan.textContent = formatarMoeda(0);
                previewValorSubstitutoSpan.textContent = formatarMoeda(valorTotal);
            }
        }
        // --- FIM: NOVAS FUNÇÕES DE PREVIEW ---

        function saveData() {
            try {
                const data = {};
                fieldsToSave.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) data[id] = element.value;
                });
                const checkedRadio = document.querySelector(`input[name="${radioNameToSave}"]:checked`);
                if (checkedRadio) data[radioNameToSave] = checkedRadio.value;
                
                localStorage.setItem('logisticaAppData', JSON.stringify(data));
            } catch (error) { console.error("Erro ao salvar dados:", error); }
        }

        function loadData() {
            try {
                const savedDataJSON = localStorage.getItem('logisticaAppData');
                if (!savedDataJSON) return;
                const data = JSON.parse(savedDataJSON);
                fieldsToSave.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && data.hasOwnProperty(id)) {
                        element.value = data[id];
                    }
                });
                if (data[radioNameToSave]) {
                    const radioToSelect = document.querySelector(`input[name="${radioNameToSave}"][value="${data[radioNameToSave]}"]`);
                    if (radioToSelect) {
                        radioToSelect.checked = true;
                        radioToSelect.dispatchEvent(new Event('change'));
                    }
                }
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                localStorage.removeItem('logisticaAppData');
            }
        }

        function processarListaMotoristas() {
            const nomesVistos = new Set();
            motoristasProcessados = motoristas.filter(m => {
                const nomeTrimmed = m.nome.trim();
                if (nomeTrimmed && !nomesVistos.has(nomeTrimmed)) {
                    nomesVistos.add(nomeTrimmed); return true;
                }
                return false;
            }).sort((a, b) => a.nome.localeCompare(b.nome));
        }

        function popularMotoristas(selectElement, driverList = motoristasProcessados) {
            const currentValue = selectElement.value;
            selectElement.innerHTML = '<option value="" disabled>-- Escolha um motorista --</option>';
            
            driverList.forEach(m => {
                const option = document.createElement('option');
                option.value = m.nome;
                option.textContent = m.nome;
                selectElement.appendChild(option);
            });

            if (driverList.some(m => m.nome === currentValue)) {
                selectElement.value = currentValue;
            } else {
                selectElement.value = "";
            }
        }
        
        function linkSearchToSelect(inputId, selectId) {
            const searchInput = document.getElementById(inputId);
            const selectElement = document.getElementById(selectId);

            searchInput.addEventListener('keyup', () => {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredDrivers = motoristasProcessados.filter(driver =>
                    driver.nome.toLowerCase().includes(searchTerm)
                );
                popularMotoristas(selectElement, filteredDrivers);
            });
        }

        function enviarEmail(destinatario, copia, assunto, corpo) {
            const corpoFormatado = encodeURIComponent(corpo);
            const assuntoFormatado = encodeURIComponent(assunto);
            let mailtoLink = `mailto:${encodeURIComponent(destinatario)}?subject=${assuntoFormatado}&body=${corpoFormatado}`;
            if (copia && copia.trim() !== '') {
                mailtoLink += `&cc=${encodeURIComponent(copia)}`;
            }
            window.location.href = mailtoLink;
        }

        function gerarEmailCredito() {
            const destinatario = emailDestinatarioInput.value;
            const copia = emailCopiaInput.value;
            const nomeMotorista = motoristaCreditoSelect.value;
            if (!destinatario || !nomeMotorista) { alert("Preencha o e-mail do destinatário e selecione um motorista."); return; }
            const kmInformado = parseFloat(kmInformadoInput.value);
            const kmPago = parseFloat(kmPagoInput.value);
            if (isNaN(kmInformado) || isNaN(kmPago) || kmInformado <= kmPago) {
                alert("Verifique os valores de KM. O 'KM Informado' deve ser maior que o 'KM Pago'."); return;
            }
            const motorista = motoristas.find(m => m.nome === nomeMotorista);
            const valorCredito = ((kmInformado - kmPago) * parseFloat(valorKmInput.value));
            const autorizacao = autorizacaoSaidaInput.value.trim();
            const textoAutorizacao = autorizacao ? `Número da Saída: ${autorizacao}\n` : '';
            const saudacao = new Date().getHours() < 12 ? "Bom dia" : "Boa tarde";
            const remetente = nomeRemetenteCreditoInput.value.trim() || "Att.";
            const assunto = `Lançamento de Crédito - Diferença de KM - ${motorista.nome}`;
            const corpo = `${saudacao} Ana,\n\nPor gentileza, lançar um crédito no valor de ${formatarMoeda(valorCredito)} para o motorista ${motorista.nome}, referente a diferença de ${kmInformado - kmPago} km ${motivoSelect.value}.\n\nSeguem os dados para conferência:\n\nMotorista: ${motorista.nome}\nLCONT00${motorista.codigo}\nPlaca: ${motorista.placa}\n${textoAutorizacao}\nQualquer dúvida, estou à disposição.\n\n${remetente}`;
            enviarEmail(destinatario, copia, assunto, corpo);
        }

        function gerarEmailPortaria() {
            const destinatario = emailDestinatarioPortariaInput.value;
            const copia = emailCopiaPortariaInput.value;
            const nomeMotorista = motoristaPortariaSelect.value;
            if (!destinatario || !nomeMotorista) { alert("Preencha o e-mail do destinatário da portaria e selecione um motorista."); return; }
            const motorista = motoristas.find(m => m.nome === nomeMotorista);
            const remetente = nomeRemetentePortariaInput.value.trim() || "Att.";
            const saudacao = new Date().getHours() < 12 ? "Bom dia" : "Boa tarde";
            const assunto = `Liberação para Abastecimento - ${motorista.nome}`;
            const corpo = `${saudacao},\n\nPor gentileza, liberar o motorista ${nomeMotorista} para fazer o abastecimento do veículo ${tipoVeiculoSelect.value}, placa ${motorista.placa}.\n\nObrigado.\n\n${remetente}`;
            enviarEmail(destinatario, copia, assunto, corpo);
        }

        function gerarEmailTransbordo() {
            const destinatario = emailDestinatarioInput.value;
            const copia = emailCopiaInput.value;
            const nomeOriginal = motoristaOriginalSelect.value;
            const nomeSubstituto = motoristaSubstitutoSelect.value;
            if (!destinatario || !nomeOriginal || !nomeSubstituto) { alert("Preencha o e-mail do destinatário e selecione os dois motoristas."); return; }
            if (nomeOriginal === nomeSubstituto) { alert("O motorista original e o substituto não podem ser os mesmos."); return; }
            const valorTotal = parseFloat(valorTotalFreteInput.value);
            if (isNaN(valorTotal) || valorTotal <= 0) { alert("Insira um valor de frete válido."); return; }
            const motoristaOriginal = motoristas.find(m => m.nome === nomeOriginal);
            const motoristaSubstituto = motoristas.find(m => m.nome === nomeSubstituto);
            const tipo = document.querySelector('input[name="tipoTransbordo"]:checked').value;
            const numeroSaida = numeroSaidaTransbordoInput.value.trim();
            const textoNumeroSaida = numeroSaida ? `Número da Saída de referência: ${numeroSaida}\n` : '';
            const saudacao = new Date().getHours() < 12 ? "Bom dia" : "Boa tarde";
            const remetente = nomeRemetenteTransbordoInput.value.trim() || "Att.";
            let assunto = '';
            let corpo = '';
            if (tipo === 'proporcional') {
                const totalEntregas = parseInt(totalEntregasInput.value);
                const entregasFeitas = parseInt(entregasFeitasInput.value);
                if (isNaN(totalEntregas) || isNaN(entregasFeitas) || totalEntregas <= 0 || entregasFeitas < 0 || entregasFeitas > totalEntregas) {
                    alert("Verifique os números de entrega. O nº de entregas feitas não pode ser maior que o total."); return;
                }
                const valorOriginal = (valorTotal / totalEntregas * entregasFeitas);
                const valorSubstituto = valorTotal - valorOriginal;
                assunto = `Lançamento Proporcional - Transbordo de Rota (Saída ${numeroSaida || 'N/A'})`;
                corpo = `${saudacao} Ana,\n\nPor favor, lançar o valor proporcional referente ao transbordo feito entre os motoristas abaixo.\n${textoNumeroSaida}\n---\nMOTORISTA ORIGINAL (com problema):\nNome: ${motoristaOriginal.nome}\nLCONT00${motoristaOriginal.codigo}\nPlaca: ${motoristaOriginal.placa}\nVALOR A RECEBER: ${formatarMoeda(valorOriginal)} (referente a ${entregasFeitas} de ${totalEntregas} entregas)\n---\nMOTORISTA SUBSTITUTO (que assumiu):\nNome: ${motoristaSubstituto.nome}\nLCONT00${motoristaSubstituto.codigo}\nPlaca: ${motoristaSubstituto.placa}\nVALOR A RECEBER: ${formatarMoeda(valorSubstituto)} (referente às ${totalEntregas - entregasFeitas} entregas restantes)\n---\n\nQualquer dúvida, estou à disposição.\n\n${remetente}`;
            } else { // Integral
                assunto = `Lançamento Integral - Transbordo de Rota (Saída ${numeroSaida || 'N/A'})`;
                corpo = `${saudacao} Ana,\n\nPor favor, lançar o valor integral do frete para o motorista substituto, conforme detalhado abaixo, devido a um problema com o veículo do motorista original antes do início das entregas.\n${textoNumeroSaida}\n---\nMOTORISTA SUBSTITUTO (que assumiu a rota completa):\nNome: ${motoristaSubstituto.nome}\nLCONT00${motoristaSubstituto.codigo}\nPlaca: ${motoristaSubstituto.placa}\nVALOR A RECEBER: ${formatarMoeda(valorTotal)} (valor integral)\n---\nO motorista original, ${motoristaOriginal.nome}, não receberá valor por esta rota.\n---\n\nQualquer dúvida, estou à disposição.\n\n${remetente}`;
            }
            enviarEmail(destinatario, copia, assunto, corpo);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            processarListaMotoristas();
            popularMotoristas(motoristaCreditoSelect);
            popularMotoristas(motoristaPortariaSelect);
            popularMotoristas(motoristaOriginalSelect);
            popularMotoristas(motoristaSubstitutoSelect);
            loadData();
            
            linkSearchToSelect('searchMotoristaCredito', 'motoristaCredito');
            linkSearchToSelect('searchMotoristaPortaria', 'motoristaPortaria');
            linkSearchToSelect('searchMotoristaOriginal', 'motoristaOriginal');
            linkSearchToSelect('searchMotoristaSubstituto', 'motoristaSubstituto');
            
            const container = document.querySelector('.container');
            container.addEventListener('change', saveData);
            container.addEventListener('keyup', saveData);

            // --- INÍCIO: NOVOS EVENT LISTENERS PARA O PREVIEW ---
            kmInformadoInput.addEventListener('input', atualizarPreviewCredito);
            kmPagoInput.addEventListener('input', atualizarPreviewCredito);
            valorKmInput.addEventListener('input', atualizarPreviewCredito);

            valorTotalFreteInput.addEventListener('input', atualizarPreviewTransbordo);
            totalEntregasInput.addEventListener('input', atualizarPreviewTransbordo);
            entregasFeitasInput.addEventListener('input', atualizarPreviewTransbordo);
            radiosTransbordo.forEach(radio => radio.addEventListener('change', atualizarPreviewTransbordo));

            // Garante que o preview seja calculado ao carregar dados salvos
            atualizarPreviewCredito();
            atualizarPreviewTransbordo();
            // --- FIM: NOVOS EVENT LISTENERS PARA O PREVIEW ---
        });
        
        gerarCreditoBtn.addEventListener('click', gerarEmailCredito);
        gerarPortariaBtn.addEventListener('click', gerarEmailPortaria);
        gerarTransbordoBtn.addEventListener('click', gerarEmailTransbordo);
        
        const modos = {
            modeCreditoBtn: document.getElementById('formCredito'),
            modePortariaBtn: document.getElementById('formPortaria'),
            modeTransbordoBtn: document.getElementById('formTransbordo'),
        };

        const generalEmailFieldsDiv = document.getElementById('generalEmailFields');

        Object.keys(modos).forEach(btnId => {
            document.getElementById(btnId).addEventListener('click', (e) => {
                e.preventDefault();
                Object.values(modos).forEach(form => form.style.display = 'none');
                document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
                
                modos[btnId].style.display = 'block';
                document.getElementById(btnId).classList.add('active');

                if (btnId === 'modePortariaBtn') {
                    generalEmailFieldsDiv.style.display = 'none';
                } else {
                    generalEmailFieldsDiv.style.display = 'block';
                }
            });
        });

        radiosTransbordo.forEach(radio => {
            radio.addEventListener('change', () => {
                camposProporcionalDiv.style.display = radio.value === 'proporcional' ? 'grid' : 'none';
            });
        });
    </script>
</body>
</html>

